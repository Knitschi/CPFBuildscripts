#!/usr/bin/env python3
"""Usage: 
    2_GetDependencies.py [<config_name>]

    Running this script runs the conan command

    conan install -pr <config_dir>/ConanProfile-<config_name> -if Configuration/<config_name> Sources --build=missing

    if the file conanfile.txt exists in the deployment-repository's root directory. 
    This command will then download or build the dependencies that are specified in the conanfile.txt
    in the configuration that is specified in the <config_dir>/ConanProfile-<config_name> conan profile file.
"""

import sys
sys.path.append('@CPFBuildscripts_DIR@')

import os
from python.docopt import docopt
from python import buildautomat
import cpfPackageVersion_CPFBuildscripts

_CPFCMake_DIR = '@CPFCMake_DIR@'
_CIBuildConfigurations_DIR = '@CIBuildConfigurations_DIR@'
_file_copied_from_version = '@CPFBuildscripts_VERSION@'

if __name__ == "__main__":
    _ARGS = docopt(__doc__, version=_file_copied_from_version)

    if not buildautomat.package_version_is_compatible_to_copied_script(_file_copied_from_version):
        print("Error: Script 2_GetDependencies.py at version {0} is no longer compatible to your CPFBuildscripts package at version {1}. You need to run 0_CopyScripts.py again to update your local build-scripts.".format(_file_copied_from_version, cpfPackageVersion_CPFBuildscripts.getPackageVersion()))
        sys.exit(1)

    _AUTOMAT = buildautomat.BuildAutomat(
        os.path.dirname(os.path.realpath(__file__)),
        _CPFCMake_DIR,
        _CIBuildConfigurations_DIR
        )

    if not _AUTOMAT.get_dependencies(_ARGS):
        print("Error: Script 2_GetDependencies.py failed.")
        sys.exit(1)
    else:
        sys.exit(0)